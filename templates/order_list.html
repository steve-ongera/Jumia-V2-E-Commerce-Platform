{% extends 'base.html' %}
{% load static %}

{% block title %}My Orders - Jumia Kenya{% endblock %}

{% block extra_css %}
<style>
    .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 15px;
    }

    .page-header {
        background: white;
        padding: 20px;
        border-radius: 4px;
        margin-bottom: 20px;
    }

    .page-title {
        font-size: 24px;
        font-weight: bold;
        color: #282828;
    }

    /* Filter Tabs */
    .filter-tabs {
        display: flex;
        gap: 5px;
        background: white;
        padding: 15px 20px;
        border-radius: 4px;
        margin-bottom: 20px;
        overflow-x: auto;
    }

    .filter-tab {
        padding: 10px 20px;
        border: 1px solid #ddd;
        background: white;
        color: #666;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        font-size: 14px;
        white-space: nowrap;
        transition: all 0.3s;
    }

    .filter-tab:hover {
        border-color: #f68b1e;
        color: #f68b1e;
    }

    .filter-tab.active {
        background: #f68b1e;
        color: white;
        border-color: #f68b1e;
    }

    .filter-count {
        display: inline-block;
        margin-left: 5px;
        padding: 2px 8px;
        background: #f0f0f0;
        border-radius: 10px;
        font-size: 12px;
    }

    .filter-tab.active .filter-count {
        background: rgba(255,255,255,0.3);
    }

    /* Order List */
    .order-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .order-item {
        background: white;
        border-radius: 4px;
        padding: 20px;
        border: 1px solid #f0f0f0;
        transition: box-shadow 0.3s;
    }

    .order-item:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .order-header {
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #f0f0f0;
        margin-bottom: 15px;
    }

    .order-number {
        font-size: 16px;
        font-weight: bold;
        color: #282828;
    }

    .order-date {
        font-size: 13px;
        color: #999;
        margin-top: 3px;
    }

    .order-status {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
    }

    .order-body {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
    }

    .order-products {
        flex: 1;
        display: flex;
        gap: 10px;
    }

    .product-thumb {
        width: 60px;
        height: 60px;
        object-fit: contain;
        border: 1px solid #f0f0f0;
        border-radius: 4px;
    }

    .order-total {
        font-size: 18px;
        font-weight: bold;
        color: #282828;
        text-align: right;
    }

    .order-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    .order-btn {
        padding: 8px 20px;
        border: 1px solid #f68b1e;
        background: white;
        color: #f68b1e;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        text-decoration: none;
        transition: all 0.3s;
    }

    .order-btn:hover {
        background: #f68b1e;
        color: white;
    }

    .empty-state {
        background: white;
        border-radius: 4px;
        padding: 60px 20px;
        text-align: center;
    }

    .empty-icon {
        font-size: 64px;
        color: #ddd;
        margin-bottom: 20px;
    }

    .empty-title {
        font-size: 20px;
        color: #282828;
        margin-bottom: 10px;
    }

    .empty-text {
        color: #666;
        margin-bottom: 20px;
    }

    @media (max-width: 768px) {
        .order-header {
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .order-body {
            flex-direction: column;
        }

        .order-total {
            text-align: left;
        }

        .filter-tabs {
            padding: 10px;
        }

        .filter-tab {
            padding: 8px 15px;
            font-size: 13px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1 class="page-title">My Orders</h1>
    </div>

    <!-- Filter Tabs -->
    <div class="filter-tabs">
        <a href="?status=all" class="filter-tab {% if status_filter == 'all' %}active{% endif %}">
            All Orders <span class="filter-count">{{ status_counts.all }}</span>
        </a>
        <a href="?status=pending" class="filter-tab {% if status_filter == 'pending' %}active{% endif %}">
            Pending <span class="filter-count">{{ status_counts.pending }}</span>
        </a>
        <a href="?status=confirmed" class="filter-tab {% if status_filter == 'confirmed' %}active{% endif %}">
            Confirmed <span class="filter-count">{{ status_counts.confirmed }}</span>
        </a>
        <a href="?status=shipped" class="filter-tab {% if status_filter == 'shipped' %}active{% endif %}">
            Shipped <span class="filter-count">{{ status_counts.shipped }}</span>
        </a>
        <a href="?status=delivered" class="filter-tab {% if status_filter == 'delivered' %}active{% endif %}">
            Delivered <span class="filter-count">{{ status_counts.delivered }}</span>
        </a>
        <a href="?status=cancelled" class="filter-tab {% if status_filter == 'cancelled' %}active{% endif %}">
            Cancelled <span class="filter-count">{{ status_counts.cancelled }}</span>
        </a>
    </div>

    {% if orders %}
    <div class="order-list">
        {% for order in orders %}
        <div class="order-item">
            <div class="order-header">
                <div>
                    <div class="order-number">Order #{{ order.order_number }}</div>
                    <div class="order-date">{{ order.created_at|date:"d M Y, H:i" }}</div>
                </div>
                <span class="order-status {{ order.status }}">{{ order.get_status_display }}</span>
                <div class="order-total">KSh {{ order.total|floatformat:0 }}</div>
            </div>

            <div class="order-body">
                <div class="order-products">
                    {% for item in order.items.all|slice:":4" %}
                        {% if item.product.images.first %}
                        <img src="{{ item.product.images.first.image.url }}" 
                             alt="{{ item.product_name }}" 
                             class="product-thumb">
                        {% else %}
                        <img src="{% static 'images/no-image.png' %}" 
                             alt="{{ item.product_name }}" 
                             class="product-thumb">
                        {% endif %}
                    {% endfor %}
                    {% if order.items.count > 4 %}
                    <div class="product-thumb" style="display: flex; align-items: center; justify-content: center; background: #f0f0f0; font-size: 12px; font-weight: bold;">
                        +{{ order.items.count|add:"-4" }}
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="order-footer">
                <a href="{% url 'order_detail' order.id %}" class="order-btn">
                    View Details
                </a>
                {% if order.status in 'pending,confirmed' %}
                <form method="POST" action="{% url 'cancel_order' order.id %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="order-btn" style="border-color: #dc3545; color: #dc3545;" 
                            onclick="return confirm('Cancel this order?')">
                        Cancel Order
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon"><i class="fas fa-box-open"></i></div>
        <h3 class="empty-title">No orders found</h3>
        <p class="empty-text">You haven't placed any orders yet</p>
        <a href="{% url 'home' %}" class="order-btn" style="display: inline-block; padding: 12px 30px;">
            Start Shopping
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}