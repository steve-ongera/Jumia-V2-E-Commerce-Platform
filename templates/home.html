{% extends 'base.html' %}
{% load static %}

{% block title %}Online Shopping in Kenya | Jumia{% endblock %}

{% block extra_css %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        color: #333;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
    }

    /* Hero Section */
    .hero-section {
        display: grid;
        grid-template-columns: 230px 1fr 280px;
        gap: 10px;
        margin-top: 10px;
        margin-bottom: 20px;
    }

    /* Category Sidebar */
    .category-sidebar {
        background: white;
        border-radius: 4px;
        overflow: hidden;
    }

    .category-item {
        padding: 12px 15px;
        border-bottom: 1px solid #f0f0f0;
        cursor: pointer;
        transition: background 0.2s;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .category-item:hover {
        background: #f8f8f8;
    }

    .category-item i {
        margin-right: 10px;
        color: #666;
    }

    /* Main Slider */
    .main-slider {
        position: relative;
        height: 380px;
        border-radius: 4px;
        overflow: hidden;
    }

    .slider-item {
        display: none;
        width: 100%;
        height: 100%;
    }

    .slider-item.active {
        display: block;
    }

    .slider-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .slider-controls {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
    }

    .slider-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: background 0.3s;
    }

    .slider-dot.active {
        background: white;
    }

    /* Side Banners */
    .side-banners {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .side-banner {
        border-radius: 4px;
        overflow: hidden;
        height: 185px;
    }

    .side-banner img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Section Header */
    .section-header {
        background: white;
        padding: 15px 20px;
        margin-bottom: 10px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .section-title {
        font-size: 22px;
        font-weight: bold;
        color: #282828;
    }

    .section-title .highlight {
        color: #f68b1e;
    }

    .see-all {
        color: #f68b1e;
        text-decoration: none;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .see-all:hover {
        text-decoration: underline;
    }

    /* Products Grid */
    .products-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
        margin-bottom: 30px;
    }

    .product-card {
        background: white;
        border-radius: 4px;
        padding: 10px;
        text-align: center;
        cursor: pointer;
        transition: box-shadow 0.3s;
        text-decoration: none;
        color: inherit;
        display: block;
    }

    .product-card:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .product-image {
        width: 100%;
        height: 150px;
        object-fit: contain;
        margin-bottom: 10px;
    }

    .product-name {
        font-size: 13px;
        color: #282828;
        margin-bottom: 8px;
        height: 36px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .product-price {
        font-size: 18px;
        font-weight: bold;
        color: #282828;
        margin-bottom: 5px;
    }

    .product-old-price {
        font-size: 13px;
        color: #999;
        text-decoration: line-through;
        margin-bottom: 5px;
    }

    .product-discount {
        display: inline-block;
        background: #feefea;
        color: #f68b1e;
        padding: 2px 8px;
        border-radius: 3px;
        font-size: 12px;
        font-weight: bold;
    }

    .product-rating {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
        margin-top: 8px;
        font-size: 12px;
    }

    .stars {
        color: #f68b1e;
    }

    .rating-count {
        color: #999;
    }

    /* Flash Timer */
    .flash-timer {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px 20px;
        background: #feefea;
        border-radius: 4px;
        margin-bottom: 10px;
    }

    .timer-label {
        font-weight: bold;
        color: #282828;
    }

    .timer-display {
        display: flex;
        gap: 5px;
    }

    .timer-unit {
        background: white;
        padding: 5px 10px;
        border-radius: 3px;
        font-weight: bold;
        color: #282828;
    }

    /* Brands Section */
    .brands-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
        margin-bottom: 30px;
    }

    .brand-card {
        background: white;
        border-radius: 4px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: box-shadow 0.3s;
    }

    .brand-card:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .brand-logo {
        width: 100%;
        height: 60px;
        object-fit: contain;
    }

    /* Category Circles */
    .category-circles {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 30px 0;
        background: white;
        padding: 20px;
        border-radius: 4px;
    }

    .category-circle {
        text-align: center;
        cursor: pointer;
        text-decoration: none;
        color: inherit;
    }

    .circle-image {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 10px;
        border: 3px solid #f0f0f0;
    }

    .circle-name {
        font-size: 13px;
        font-weight: 500;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .hero-section {
            grid-template-columns: 1fr;
        }
        
        .category-sidebar {
            display: none;
        }
        
        .side-banners {
            display: none;
        }
        
        .products-grid {
            grid-template-columns: repeat(4, 1fr);
        }
        
        .brands-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    @media (max-width: 768px) {
        .products-grid {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .brands-grid {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .category-circles {
            flex-wrap: wrap;
        }
    }

    @media (max-width: 480px) {
        .products-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .brands-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="hero-section">
        <!-- Category Sidebar -->
        <div class="category-sidebar">
            {% for category in main_categories %}
            <a href="{% url 'category_products' category.slug %}" class="category-item">
                <span>
                    {% if category.icon %}<i class="{{ category.icon }}"></i>{% endif %}
                    {{ category.name }}
                </span>
                <i class="fas fa-chevron-right"></i>
            </a>
            {% endfor %}
        </div>

        <!-- Main Slider -->
        <div class="main-slider">
            {% for banner in banners %}
            <div class="slider-item {% if forloop.first %}active{% endif %}">
                <a href="{{ banner.link }}">
                    <img src="{{ banner.image.url }}" alt="{{ banner.title }}">
                </a>
            </div>
            {% endfor %}
            
            <div class="slider-controls">
                {% for banner in banners %}
                <span class="slider-dot {% if forloop.first %}active{% endif %}" data-index="{{ forloop.counter0 }}"></span>
                {% endfor %}
            </div>
        </div>

        <!-- Side Banners -->
        <div class="side-banners">
            <div class="side-banner">
                <img src="{% static 'images/promo1.png' %}" alt="Promo">
            </div>
            <div class="side-banner">
                <img src="{% static 'images/ezgif-81f1a89eea3191.gif' %}" alt="Promo">
            </div>
        </div>
    </div>

    <!-- Category Circles -->
    <div class="category-circles">
        {% for category in main_categories|slice:":8" %}
        <a href="{% url 'category_products' category.slug %}" class="category-circle">
            {% if category.image %}
            <img src="{{ category.image.url }}" alt="{{ category.name }}" class="circle-image">
            {% else %}
            <div class="circle-image" style="background: #f0f0f0;"></div>
            {% endif %}
            <div class="circle-name">{{ category.name }}</div>
        </a>
        {% endfor %}
    </div>

    <!-- Flash Sales -->
    {% if flash_sales %}
    <div class="flash-timer">
        <span class="timer-label">⚡ Flash Sales</span>
        <div class="timer-display">
            <span class="timer-unit" id="hours">00</span>
            <span>:</span>
            <span class="timer-unit" id="minutes">00</span>
            <span>:</span>
            <span class="timer-unit" id="seconds">00</span>
        </div>
    </div>
    
    <div class="section-header">
        <h2 class="section-title"><span class="highlight">Flash Sales</span></h2>
        <a href="#" class="see-all">
            SEE ALL <i class="fas fa-chevron-right"></i>
        </a>
    </div>
    
    <div class="products-grid">
        {% for product in flash_sales %}
        <a href="{% url 'product_detail' product.slug %}" class="product-card">
            {% if product.images.first %}
            <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
            <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" class="product-image">
            {% endif %}
            
            <div class="product-name">{{ product.name }}</div>
            
            <div class="product-price">KSh {{ product.price|floatformat:0 }}</div>
            
            {% if product.compare_price %}
            <div class="product-old-price">KSh {{ product.compare_price|floatformat:0 }}</div>
            <span class="product-discount">-{{ product.discount_percentage }}%</span>
            {% endif %}
            
            <div class="product-rating">
                <span class="stars">★★★★☆</span>
                <span class="rating-count">({{ product.reviews.count }})</span>
            </div>
        </a>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Top Deals -->
    {% if top_deals %}
    <div class="section-header">
        <h2 class="section-title">Top Deals</h2>
        <a href="#" class="see-all">
            SEE ALL <i class="fas fa-chevron-right"></i>
        </a>
    </div>
    
    <div class="products-grid">
        {% for product in top_deals %}
        <a href="{% url 'product_detail' product.slug %}" class="product-card">
            {% if product.images.first %}
            <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
            <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" class="product-image">
            {% endif %}
            
            <div class="product-name">{{ product.name }}</div>
            <div class="product-price">KSh {{ product.price|floatformat:0 }}</div>
            
            {% if product.compare_price %}
            <div class="product-old-price">KSh {{ product.compare_price|floatformat:0 }}</div>
            <span class="product-discount">-{{ product.discount_percentage }}%</span>
            {% endif %}
            
            <div class="product-rating">
                <span class="stars">★★★★☆</span>
                <span class="rating-count">({{ product.reviews.count }})</span>
            </div>
        </a>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Phones & Tablets -->
    {% if phones_products %}
    <div class="section-header">
        <h2 class="section-title">Phones & Tablets</h2>
        <a href="{% url 'category_products' phones_tablets.slug %}" class="see-all">
            SEE ALL <i class="fas fa-chevron-right"></i>
        </a>
    </div>
    
    <div class="products-grid">
        {% for product in phones_products %}
        <a href="{% url 'product_detail' product.slug %}" class="product-card">
            {% if product.images.first %}
            <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
            <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" class="product-image">
            {% endif %}
            
            <div class="product-name">{{ product.name }}</div>
            <div class="product-price">KSh {{ product.price|floatformat:0 }}</div>
            
            {% if product.compare_price %}
            <div class="product-old-price">KSh {{ product.compare_price|floatformat:0 }}</div>
            <span class="product-discount">-{{ product.discount_percentage }}%</span>
            {% endif %}
            
            <div class="product-rating">
                <span class="stars">★★★★☆</span>
                <span class="rating-count">({{ product.reviews.count }})</span>
            </div>
        </a>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Top Brands -->
    {% if top_brands %}
    <div class="section-header">
        <h2 class="section-title">Shop by Brand</h2>
        <a href="#" class="see-all">
            SEE ALL <i class="fas fa-chevron-right"></i>
        </a>
    </div>
    
    <div class="brands-grid">
        {% for brand in top_brands %}
        <a href="#" class="brand-card">
            {% if brand.logo %}
            <img src="{{ brand.logo.url }}" alt="{{ brand.name }}" class="brand-logo">
            {% else %}
            <div style="font-size: 18px; font-weight: bold; padding: 20px 0;">{{ brand.name }}</div>
            {% endif %}
        </a>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Electronics -->
    {% if electronics_products %}
    <div class="section-header">
        <h2 class="section-title">Electronics</h2>
        <a href="{% url 'category_products' electronics.slug %}" class="see-all">
            SEE ALL <i class="fas fa-chevron-right"></i>
        </a>
    </div>
    
    <div class="products-grid">
        {% for product in electronics_products %}
        <a href="{% url 'product_detail' product.slug %}" class="product-card">
            {% if product.images.first %}
            <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
            <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" class="product-image">
            {% endif %}
            
            <div class="product-name">{{ product.name }}</div>
            <div class="product-price">KSh {{ product.price|floatformat:0 }}</div>
            
            {% if product.compare_price %}
            <div class="product-old-price">KSh {{ product.compare_price|floatformat:0 }}</div>
            <span class="product-discount">-{{ product.discount_percentage }}%</span>
            {% endif %}
            
            <div class="product-rating">
                <span class="stars">★★★★☆</span>
                <span class="rating-count">({{ product.reviews.count }})</span>
            </div>
        </a>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Fashion -->
    {% if fashion_products %}
    <div class="section-header">
        <h2 class="section-title">Fashion</h2>
        <a href="{% url 'category_products' fashion.slug %}" class="see-all">
            SEE ALL <i class="fas fa-chevron-right"></i>
        </a>
    </div>
    
    <div class="products-grid">
        {% for product in fashion_products %}
        <a href="{% url 'product_detail' product.slug %}" class="product-card">
            {% if product.images.first %}
            <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
            <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" class="product-image">
            {% endif %}
            
            <div class="product-name">{{ product.name }}</div>
            <div class="product-price">KSh {{ product.price|floatformat:0 }}</div>
            
            {% if product.compare_price %}
            <div class="product-old-price">KSh {{ product.compare_price|floatformat:0 }}</div>
            <span class="product-discount">-{{ product.discount_percentage }}%</span>
            {% endif %}
            
            <div class="product-rating">
                <span class="stars">★★★★☆</span>
                <span class="rating-count">({{ product.reviews.count }})</span>
            </div>
        </a>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Home & Kitchen -->
    {% if home_kitchen_products %}
    <div class="section-header">
        <h2 class="section-title">Home & Kitchen</h2>
        <a href="{% url 'category_products' home_kitchen.slug %}" class="see-all">
            SEE ALL <i class="fas fa-chevron-right"></i>
        </a>
    </div>
    
    <div class="products-grid">
        {% for product in home_kitchen_products %}
        <a href="{% url 'product_detail' product.slug %}" class="product-card">
            {% if product.images.first %}
            <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
            <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" class="product-image">
            {% endif %}
            
            <div class="product-name">{{ product.name }}</div>
            <div class="product-price">KSh {{ product.price|floatformat:0 }}</div>
            
            {% if product.compare_price %}
            <div class="product-old-price">KSh {{ product.compare_price|floatformat:0 }}</div>
            <span class="product-discount">-{{ product.discount_percentage }}%</span>
            {% endif %}
            
            <div class="product-rating">
                <span class="stars">★★★★☆</span>
                <span class="rating-count">({{ product.reviews.count }})</span>
            </div>
        </a>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Slider functionality
    document.addEventListener('DOMContentLoaded', function() {
        const sliderItems = document.querySelectorAll('.slider-item');
        const dots = document.querySelectorAll('.slider-dot');
        let currentSlide = 0;
        
        function showSlide(index) {
            sliderItems.forEach(item => item.classList.remove('active'));
            dots.forEach(dot => dot.classList.remove('active'));
            
            sliderItems[index].classList.add('active');
            dots[index].classList.add('active');
        }
        
        function nextSlide() {
            currentSlide = (currentSlide + 1) % sliderItems.length;
            showSlide(currentSlide);
        }
        
        // Auto-advance slider every 5 seconds
        setInterval(nextSlide, 5000);
        
        // Dot click handlers
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => {
                currentSlide = index;
                showSlide(currentSlide);
            });
        });
        
        // Flash sale countdown timer
        function updateTimer() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const diff = tomorrow - now;
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        }
        
        // Update timer every second
        updateTimer();
        setInterval(updateTimer, 1000);
    });
</script>
{% endblock %}