{% extends 'auth/auth_base.html' %}

{% block title %}Create Account - Jumia Kenya{% endblock %}

{% block content %}
<div class="auth-icon">
    <i class="fas fa-user-plus"></i>
</div>

<h1 class="auth-title">Create your Jumia Account</h1>
<p class="auth-subtitle">Sign up with your email and get access to thousands of products.</p>

<!-- Messages -->
{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Registration Form -->
<form method="POST" id="registerForm">
    {% csrf_token %}
    
    <div class="form-group">
        <label class="form-label" for="first_name">First Name*</label>
        <input 
            type="text" 
            class="form-control" 
            id="first_name" 
            name="first_name" 
            placeholder="Enter your first name"
            required
        >
    </div>

    <div class="form-group">
        <label class="form-label" for="last_name">Last Name*</label>
        <input 
            type="text" 
            class="form-control" 
            id="last_name" 
            name="last_name" 
            placeholder="Enter your last name"
            required
        >
    </div>

    <div class="form-group">
        <label class="form-label" for="email">Email*</label>
        <input 
            type="email" 
            class="form-control" 
            id="email" 
            name="email" 
            placeholder="Enter your email address"
            required
        >
        <span class="error-message" id="emailError"></span>
    </div>

    <div class="form-group">
        <label class="form-label" for="phone_number">Phone Number*</label>
        <input 
            type="tel" 
            class="form-control" 
            id="phone_number" 
            name="phone_number" 
            placeholder="e.g., 0712345678"
            required
        >
    </div>

    <div class="form-group">
        <label class="form-label" for="password">Password*</label>
        <input 
            type="password" 
            class="form-control" 
            id="password" 
            name="password" 
            placeholder="Enter your password (min. 6 characters)"
            required
        >
        <span class="error-message" id="passwordError"></span>
    </div>

    <div class="form-group">
        <label class="form-label" for="confirm_password">Confirm Password*</label>
        <input 
            type="password" 
            class="form-control" 
            id="confirm_password" 
            name="confirm_password" 
            placeholder="Re-enter your password"
            required
        >
        <span class="error-message" id="confirmPasswordError"></span>
    </div>

    <button type="submit" class="btn btn-primary" id="submitBtn">Create Account</button>

    <div class="divider">
        <span>OR</span>
    </div>

    <button type="button" class="btn btn-facebook" onclick="signupWithFacebook()">
        <i class="fab fa-facebook"></i>
        Sign up with Facebook
    </button>

    <button type="button" class="btn btn-google" onclick="signupWithGoogle()">
        <i class="fab fa-google"></i>
        Sign up with Google
    </button>
</form>

<div class="auth-links" style="margin-top: 30px;">
    Already have an account? <a href="{% url 'login' %}" class="auth-link">Log in</a>
</div>

<div class="terms-text">
    By continuing you agree to Jumia's
    <a href="#" class="terms-link">Terms and Conditions</a>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function signupWithFacebook() {
        alert('Facebook signup will be implemented');
    }

    function signupWithGoogle() {
        alert('Google signup will be implemented');
    }

    // Form validation
    const form = document.getElementById('registerForm');
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    const email = document.getElementById('email');

    // Password match validation
    confirmPassword.addEventListener('input', function() {
        const errorMsg = document.getElementById('confirmPasswordError');
        if (this.value && this.value !== password.value) {
            errorMsg.textContent = 'Passwords do not match';
            this.classList.add('error');
        } else {
            errorMsg.textContent = '';
            this.classList.remove('error');
        }
    });

    // Password length validation
    password.addEventListener('input', function() {
        const errorMsg = document.getElementById('passwordError');
        if (this.value.length > 0 && this.value.length < 6) {
            errorMsg.textContent = 'Password must be at least 6 characters';
            this.classList.add('error');
        } else {
            errorMsg.textContent = '';
            this.classList.remove('error');
        }
    });

    // Check if email exists
    email.addEventListener('blur', function() {
        const emailValue = this.value.trim();
        if (emailValue && emailValue.includes('@')) {
            fetch('{% url "check_email" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ email: emailValue })
            })
            .then(response => response.json())
            .then(data => {
                const errorMsg = document.getElementById('emailError');
                if (data.exists) {
                    errorMsg.textContent = 'This email is already registered';
                    email.classList.add('error');
                } else {
                    errorMsg.textContent = '';
                    email.classList.remove('error');
                }
            });
        }
    });

    // Form submission
    form.addEventListener('submit', function(e) {
        const submitBtn = document.getElementById('submitBtn');
        
        // Check if passwords match
        if (password.value !== confirmPassword.value) {
            e.preventDefault();
            alert('Passwords do not match');
            return;
        }

        // Check password length
        if (password.value.length < 6) {
            e.preventDefault();
            alert('Password must be at least 6 characters');
            return;
        }

        // Disable submit button
        submitBtn.disabled = true;
        submitBtn.textContent = 'Creating Account...';
    });
</script>
{% endblock %}