{% extends 'auth/auth_base.html' %}

{% block title %}Change Password - Jumia Kenya{% endblock %}

{% block content %}
<div class="auth-icon">
    <i class="fas fa-shield-alt"></i>
</div>

<h1 class="auth-title">Change Password</h1>
<p class="auth-subtitle">Update your account password for security.</p>

<!-- Messages -->
{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Change Password Form -->
<form method="POST" id="changePasswordForm">
    {% csrf_token %}
    
    <div class="form-group">
        <label class="form-label" for="old_password">Current Password*</label>
        <input 
            type="password" 
            class="form-control" 
            id="old_password" 
            name="old_password" 
            placeholder="Enter your current password"
            required
        >
    </div>

    <div class="form-group">
        <label class="form-label" for="new_password">New Password*</label>
        <input 
            type="password" 
            class="form-control" 
            id="new_password" 
            name="new_password" 
            placeholder="Enter new password (min. 6 characters)"
            required
        >
        <span class="error-message" id="passwordError"></span>
    </div>

    <div class="form-group">
        <label class="form-label" for="confirm_password">Confirm New Password*</label>
        <input 
            type="password" 
            class="form-control" 
            id="confirm_password" 
            name="confirm_password" 
            placeholder="Re-enter your new password"
            required
        >
        <span class="error-message" id="confirmPasswordError"></span>
    </div>

    <button type="submit" class="btn btn-primary" id="submitBtn">Change Password</button>
</form>

<div class="auth-links" style="margin-top: 30px;">
    <a href="{% url 'account' %}" class="auth-link">Back to Account</a>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const form = document.getElementById('changePasswordForm');
    const newPassword = document.getElementById('new_password');
    const confirmPassword = document.getElementById('confirm_password');

    // Password length validation
    newPassword.addEventListener('input', function() {
        const errorMsg = document.getElementById('passwordError');
        if (this.value.length > 0 && this.value.length < 6) {
            errorMsg.textContent = 'Password must be at least 6 characters';
            this.classList.add('error');
        } else {
            errorMsg.textContent = '';
            this.classList.remove('error');
        }
    });

    // Password match validation
    confirmPassword.addEventListener('input', function() {
        const errorMsg = document.getElementById('confirmPasswordError');
        if (this.value && this.value !== newPassword.value) {
            errorMsg.textContent = 'Passwords do not match';
            this.classList.add('error');
        } else {
            errorMsg.textContent = '';
            this.classList.remove('error');
        }
    });

    // Form submission
    form.addEventListener('submit', function(e) {
        const submitBtn = document.getElementById('submitBtn');
        
        // Check if passwords match
        if (newPassword.value !== confirmPassword.value) {
            e.preventDefault();
            alert('Passwords do not match');
            return;
        }

        // Check password length
        if (newPassword.value.length < 6) {
            e.preventDefault();
            alert('Password must be at least 6 characters');
            return;
        }

        // Disable submit button
        submitBtn.disabled = true;
        submitBtn.textContent = 'Changing...';
    });
</script>
{% endblock %}